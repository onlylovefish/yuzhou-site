import{_ as i,c as a,a as e,o as n}from"./app-BKURSIeJ.js";const t={};function l(p,s){return n(),a("div",null,s[0]||(s[0]=[e(`<p>本节主要分析fiber如果影响最终的渲染</p><p>Fiber树众多属性，有两块内容</p><ol><li>fiber节点的自身状态，在renderRootSync【Concurrent】阶段，为子节点提供确定的输入数据，影响子节点生成</li><li>fiber节点的副作用：在commitRoot阶段，如果fiber被标记有副作用，则副作用相关函数会（同步/异步）被调用</li></ol><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">export</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> type</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Fiber</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {|</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // 1. fiber节点自身状态相关</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  pendingProps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">any</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  memoizedProps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">any</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  updateQueue</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">mixed</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  memoizedState</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">any</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  // 2. fiber节点副作用(Effect)相关</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  flags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Flags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  subtreeFlags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Flags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // v17.0.2未启用</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  deletions</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Array</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Fiber</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt; | </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">null</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // v17.0.2未启用</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">|};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pendingprops" tabindex="-1"><a class="header-anchor" href="#pendingprops"><span>pendingProps</span></a></h2><p>fiber.pendingProps: 输入属性, 从ReactElement对象传入的 props. 它和fiber.memoizedProps比较可以得出属性是否变动.</p><h2 id="memoizedprops" tabindex="-1"><a class="header-anchor" href="#memoizedprops"><span>memoizedProps</span></a></h2><p>fiber.memoizedProps: 上一次生成子节点时用到的属性, 生成子节点之后保持在内存中. 向下生成子节点之前叫做pendingProps, 生成子节点之后会把pendingProps赋值给memoizedProps用于下一次比较.pendingProps和memoizedProps比较可以得出属性是否变动</p><h2 id="updatequeue-的主要功能" tabindex="-1"><a class="header-anchor" href="#updatequeue-的主要功能"><span>updateQueue 的主要功能</span></a></h2><ol><li>管理 hooks 的副作用链表 对于函数组件，updateQueue 里保存了 hooks 的 effect 环形链表（如 useEffect、useLayoutEffect 等）。</li></ol><p>结构通常是 { lastEffect: Effect | null }，每个 effect 通过 next 字段串成环。</p><ol start="2"><li>管理 hooks 的 state 更新队列</li></ol><p>对于 useState、useReducer 等 hooks，updateQueue 还会存储 state 的更新队列（链表），用于调度和合并多次 setState。</p><ol start="3"><li>存储其它 hooks 相关的数据 例如 stores（用于 useSyncExternalStore）、memoizedState（hooks 链表头）等。</li></ol><h2 id="memoizedstate" tabindex="-1"><a class="header-anchor" href="#memoizedstate"><span>memoizedState</span></a></h2><p>fiber.memoizedState: 上一次生成子节点之后保持在内存中的局部状态.</p>`,16)]))}const r=i(t,[["render",l]]),d=JSON.parse('{"path":"/article/lv2hr4j8/","title":"状态和副作用","lang":"zh-CN","frontmatter":{"title":"状态和副作用","createTime":"2025/11/09 18:15:13","permalink":"/article/lv2hr4j8/"},"readingTime":{"minutes":1.39,"words":417},"git":{"createdTime":1762703255000,"updatedTime":1762703255000,"contributors":[{"name":"onlylovefish","username":"onlylovefish","email":"2511452548@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/onlylovefish?v=4","url":"https://github.com/onlylovefish"}]},"filePathRelative":"sourceCode/react篇/状态和副作用.md","headers":[],"categoryList":[{"id":"6459a8","sort":10000,"name":"sourceCode"},{"id":"d601c1","sort":10001,"name":"react篇"}]}');export{r as comp,d as data};
